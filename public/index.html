<!DOCTYPE html>
<html ng-app="kastor">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="http://maps.google.com/maps/api/js"></script>
    <script src="ngmap/build/scripts/ng-map.min.js"></script>
    <script src="controller.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body ng-controller="mainController" ng-init="init()">
    <img src="logo_1934209_web.jpg">
    <div id="controls">
        <h2>Display a route</h2>
        There are {{ routes.length }} routes in the database.
        <p>
        <div id="route-list" class="row">
            <!-- LOOP OVER $scope.routes -->
            <div id= "route-list-element" ng-repeat="route in routes">
                <b>{{ route.date | date:'dd.MM.yyyy'}} {{ route.title }}</b><br>
                {{ route.comment }}<br>
                <button id="view-details-button" ng-click="showRoute(route._id)">view</button>
                <button id="delete-button" ng-click="deleteRoute(route._id)">delete</button>
            </div>
        </div>
        </p>
        
        <h2>Upload a new route</h2>
        
        <form method="post" action="routes" enctype="multipart/form-data" id="upload_form">
            <input type="file" name="route_file">
            <p>
            <input type="text" name="title" value="Insert title">
            <p>
            <input type="text" name="weather" value="Weather description">
            <p>
            <textarea name="comment" cols="40" rows="4" form="upload_form">Insert comment</textarea>
            <p>
            <input type="submit" value="Submit">    
        </form>
        <p>
        NB. Everything you upload is visible to everybody. Your data is not guaranteed to retain.
        </p>
        
    </div>        
    <div ng-controller="routeVisualizationController as vc" id="map-canvas" map-lazy-load="https://maps.google.com/maps/api/js" ng-init="initMap()">
        <ng-map zoom="{{ mapPosition.zoom }}" center="[{{ mapPosition.lat }}, {{ mapPosition.lng }}]" map-type-id="TERRAIN" style="width:1000px;height:600px;">
            <shape name = "polyline" id = "routeShape"
                icons = "[{
                     icon: {
                        path: 'CIRCLE',
                        scale: 6,
                        strokeColor: '#393' },
                     offset: '0%'
                 }]"            
                path = "{{ route.data.trackPoints }}"
                stroke-color = "#990000"
                stroke-opacity = "0.2"
                stroke-weight = "5">
            </shape>
        </ng-map>
        <div id="route-data">
            <div id="route-data-dynamic">
                <div id="route-data-hr">Heart rate<br><span id="bpm">{{ cursor.bpm }}</span></div>
                <div id="route-data-duration">Time<br><span id="duration">{{ cursor.duration }}</span></div>
                <div id="route-data-altitude">Climb<br><span id="altitude">{{ cursor.climb | number:1 }}</span></div>
                <div id="route-data-climb">Distance<br><span id="climb">{{ cursor.distance | number:1 }}</span></div>
                <div id="route-playback-controls">
                    <button id="play-button" ng-click="playRoute()">Play</button>
                    <button id="stop-button" ng-click="stopRoute()">Stop</button>
                    Speed: <input id="multiplier-slider" type="range" value=1 min=1 max=50 step=1 ng-model="playbackMultiplier"/ list="multipliers">
                    <datalist id="multipliers">
                      <option>5</option>
                      <option>10</option>
                      <option>15</option>
                      <option>20</option>
                      <option>25</option>
                      <option>30</option>
                      <option>35</option>
                      <option>40</option>
                      <option>45</option>
                    </datalist>
                </div>
            </div>
            <table>
                <tr><td>Title</td><td><input type="text" name="saved-title" ng-model="route.title"></td></tr>
                <tr><td>Start time</td><td>{{ route.data.startTime | date:'dd.MM.yyyy HH:mm:ss'}}</td></tr>
                <tr><td>Duration</td><td>{{ route.data.duration}}</td></tr>
                <tr><td>Length (meters)</td><td>{{ route.data.distance | number:2 }}</td></tr>
                <tr><td>Device</td><td>{{ route.data.device }}</td></tr>
                <tr><td>Weather</td><td><input type="text" name="saved-weather" ng-model="route.weather"></td></tr>
                <tr><td>Comment</td><td><textarea name="saved-comment" cols="40" rows="3" ng-model="route.comment"></textarea></td></tr>
                <tr><td>Updated</td><td>{{ route.updated | date:'dd.MM.yyyy HH:mm'}}</td></tr>
                <tr><td></td><td><button ng-click="updateRoute(route._id)">Save changes</button></td></tr>
            </table>
        </div>
    </div>
  </body>