<!DOCTYPE html>
<html ng-app="kastor">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="http://maps.google.com/maps/api/js"></script>
    <script src="ngmap/build/scripts/ng-map.min.js"></script>
    <script src="controller.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body ng-controller="mainController" ng-init="init()">
    <img src="logo_1934209_web.jpg">
    <div id="controls">
        <h2>Display a route</h2>
        There are {{ routes.length }} routes in the database.
        <p>
        <div id="route-list" class="row">
            <!-- LOOP OVER $scope.routes -->
            <div id= "route-list-element" ng-repeat="route in routes">
                <b>{{ route.date }} {{ route.title }}</b><br>
                {{ route.comment }}<br>
                <button id="view-details-button" ng-click="showRoute(route._id)">view</button>
                <button id="delete-button" ng-click="deleteRoute(route._id)">delete</button>
            </div>
        </div>
        </p>
        
        <h2>Upload a new route</h2>
        
        <form method="post" action="routes" enctype="multipart/form-data" id="upload_form">
            <input type="file" name="route_file">
            <p>
            <input type="text" name="title" value="Insert title">
            <p>
            <input type="text" name="weather" value="Weather description">
            <p>
            <textarea name="comment" cols="40" rows="4" form="upload_form">Insert comment</textarea>
            <p>
            <input type="submit" value="Submit">    
        </form>
        <p>
        NB. Everything you upload is visible to everybody. Your data is not guaranteed to retain.
        </p>
        
    </div>        
    <div ng-controller="routeAnimationController as vm" id="map-canvas" map-lazy-load="https://maps.google.com/maps/api/js">
        <ng-map zoom="15" center="{{ route.data.trackPoints[0] }}" map-type-id="TERRAIN" style="width:1000px;height:600px;">
            <shape name = "polyline" id = "routeShape"
                icons = "[{
                    icon: {
                        path: 'CIRCLE',
                        scale: 8,
                        strokeColor: '#393'
                        
                    },
                    offset: '0%'
                }]"
                path = "{{ route.data.trackPoints }}"
                stroke-color = "#990000"
                stroke-opacity = "1.0"
                stroke-weight = "2">
            </shape>
        </ng-map>
    <div id="route-data">
        <div id="route-data-details">
        Start time: {{ route.data.startTime }}<br>
        End time: {{ route.data.trackPoints[route.data.trackPoints.length-1].timeStamp }}<br>
        Length: {{ route.data.trackPoints[route.data.trackPoints.length-1].distance }}<br>
        Device: {{ route.data.device }}<br>
        </div>
        <div id="route-data-hr">
        </div>
        <div id="route-data-altitude">
        </div>
    </div>
    </div>
    <p>
    <div id="route-title">
        <input type="text" name="saved-title" ng-model="route.title">
    </div>
    <div id="route-weather">
        <input type="text" name="saved-weather" ng-model="route.weather">
    </div>
    <div id="route-comment">
        <textarea name="saved-comment" cols="40" rows="4" ng-model="route.comment"></textarea>    
    </div>
    Last updated: {{ route.updated }}<br>
    <button ng-click="updateRoute(route._id)">Save changes</button>
    
    <div id="status-bar">
        {{ status.text }}
    </div>
    
  </body>