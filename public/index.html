<!DOCTYPE html>
<html ng-app="kastor">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="http://maps.google.com/maps/api/js"></script>
    <script src="ngmap/build/scripts/ng-map.min.js"></script>
    <script src="controller.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>

<body ng-controller="mainController" ng-init="init()">
    <img src="logo_1934209_web.jpg">
    NB. Palvelu on kehitysvaiheessa. Kaikki näkevät reittisi tietoineen. Tietojen säilymistä ei taata.
    <div id="main-div">
        <div id="right-panel">
            <div id="route-list" class="row">
                <div id= "route-list-element-new">
                    <b>Lisää uusi reitti tcx- tai gpx- tiedostosta.</b>
                    <form method="post" action="routes" enctype="multipart/form-data" id="upload_form">
                        <span id="add-route-plus-sign">+</span> <input type="file" name="route_file">
                        <input type="submit" value="Lataa reittitiedosto palvelimelle">    
                    </form>
                </div>
                <div id= "route-list-element" ng-repeat="route in routes">
                    <b>{{ route.date | date:'dd.MM.yyyy'}} {{ route.title }}</b><br>
                    {{ route.comment }}<br>
                    <button id="view-details-button" ng-click="showRoute(route._id)">Näytä</button>
                </div>
            </div>
        </div>        
    <div ng-controller="routeVisualizationController as vc" id="map-canvas" map-lazy-load="https://maps.google.com/maps/api/js" ng-init="initMap()">
        <ng-map zoom="{{ mapPosition.zoom }}" center="[{{ mapPosition.lat }}, {{ mapPosition.lng }}]" map-type-id="TERRAIN" style="width:1000px;height:500px;">
            <shape name = "polyline" id = "routeShape"
                icons = "[{
                     icon: {
                        path: 'CIRCLE',
                        scale: 6,
                        strokeOpacity: 0.8,
                        strokeColor: '#393' },
                     offset: '0%'
                 }]"            
                path = "{{ route.data.trackPoints }}"
                stroke-color = "#990000"
                stroke-opacity = "0.2"
                stroke-weight = "5">
            </shape>
        </ng-map>
        <div id="route-data">
            <div id="route-data-dynamic">
                <div id="route-data-velocity">Km/h<br><span id="velocity">{{ cursor.velocity | number:1 }}</span></div>
                <div id="route-data-climb">Pituus [m]<br><span id="distance">{{ cursor.distance | number:0 }}</span></div>
                <div id="route-data-duration">Kesto<br><span id="duration">{{ cursor.duration }}</span></div>
                <div id="route-data-hr">Syke<br><span id="bpm">{{ cursor.bpm }}</span></div>
                <div id="route-data-climb">Nousu [m]<br><span id="climb">{{ cursor.climb | number:1 }}</span></div>
                <div id="route-data-speed">Min/km<br><span id="speed">{{ cursor.speed | number:1 }}</span></div>
                <div id="route-playback-controls">
                    <button id="play-button" ng-click="playRoute()"><span>Play</span></button>
                    <button id="stop-button" ng-click="stopRoute()">Stop</button>
                    <input id="multiplier-slider" type="range" min=1 max=8 step=1 ng-model="playbackMultiplier"/>
                    <br>
                    Toistonopeus: {{ playbackMultiplier }}x
                </div>
            </div>
            <table>
                <tr>
                    <td>Otsikko</td>
                    <td><input type="text" name="saved-title" ng-model="route.title" ng-show="editorEnabled"><span ng-hide="editorEnabled">{{ route.title }}</span></td>
                </tr>
                <tr>
                    <td>Aloitusaika</td>
                    <td>{{ route.data.startTime | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                </tr>
                <tr>
                    <td>Kesto [min]</td>
                    <td>{{ route.data.duration}}</td>
                </tr>
                <tr>
                    <td>Pituus [m]</td>
                    <td>{{ route.data.distance | number:2 }}</td>
                </tr>
                <tr>
                    <td>Nousu [m]</td>
                    <td>{{ route.data.climb | number:1 }}</td>
                </tr>
                <tr>
                    <td>Km/h</td>
                    <td>{{ totalVelocity | number:2 }}</td>
                </tr>
                <tr>
                    <td>Min/km</td>
                    <td>{{ totalSpeed | number:2 }}</td>
                </tr>
                <tr>
                    <td>Sää</td>
                    <td><input type="text" name="saved-weather" ng-model="route.weather" ng-show="editorEnabled"><span ng-hide="editorEnabled">{{ route.weather }}</span></td>
                </tr>
                <tr>
                    <td>Kuvaus</td>
                    <td><textarea name="saved-comment" cols="40" rows="3" ng-model="route.comment" ng-show="editorEnabled"></textarea><span ng-hide="editorEnabled">{{ route.comment }}</span></td>
                </tr>
                <tr>
                    <td>Laite</td>
                    <td>{{ route.data.device }}</td>
                    </tr>
                <tr>
                    <td>Päivitetty</td>
                    <td>{{ route.updated | date:'dd.MM.yyyy HH:mm'}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                    <button id="edit-button" ng-click="enableEditor()" ng-hide="editorEnabled">Muokkaa tietoja</button>
                    <button id="save-changes-button" ng-click="updateRoute(route._id)" ng-show="editorEnabled">Tallenna muutokset</button>
                    <button id="cancel-button" ng-click="cancelEdit(route._id)" ng-show="editorEnabled">Kumoa muutokset</button>
                    <button id="delete-button" ng-click="deleteRoute(route._id)" ng-show="editorEnabled">Poista reitti</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
  </div>    
</body>