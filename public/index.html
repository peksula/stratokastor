<!DOCTYPE html>
<html ng-app="kastor">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="http://maps.google.com/maps/api/js"></script>
    <script src="ngmap/build/scripts/ng-map.min.js"></script>
    <script src="controller.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body ng-controller="mainController" ng-init="init()">
    <img src="logo_1934209_web.jpg">
    <div id="controls">
        <h2>Display a route</h2>
        There are {{ routes.length }} routes in the database.
        <p>
        <div id="route-list" class="row">
            <!-- LOOP OVER $scope.routes -->
            <div id= "route-list-element" ng-repeat="route in routes">
                <b>{{ route.date }} {{ route.title }}</b><br>
                {{ route.comment }}<br>
                <button id="view-details-button" ng-click="showRoute(route._id)">view</button>
                <button id="delete-button" ng-click="deleteRoute(route._id)">delete</button>
            </div>
        </div>
        </p>
        
        <h2>Upload a new route</h2>
        
        <form method="post" action="routes" enctype="multipart/form-data" id="upload_form">
            <input type="file" name="route_file">
            <p>
            <input type="text" name="title" value="Insert title">
            <p>
            <input type="text" name="weather" value="Weather description">
            <p>
            <textarea name="comment" cols="40" rows="4" form="upload_form">Insert comment</textarea>
            <p>
            <input type="submit" value="Submit">    
        </form>
        <p>
        NB. Everything you upload is visible to everybody. Your data is not guaranteed to retain.
        </p>
        
    </div>        
    <div ng-controller="routeAnimationController as vm" id="map-canvas" map-lazy-load="https://maps.google.com/maps/api/js">
        <ng-map zoom="15" center="{{ route.data.trackPoints[0] }}" map-type-id="TERRAIN" style="width:1000px;height:600px;">
            <shape name = "polyline" id = "routeShape"
                icons = "[{
                    icon: {
                        path: 'CIRCLE',
                        scale: 8,
                        strokeColor: '#393'
                        
                    },
                    offset: '0%'
                }]"
                path = "{{ route.data.trackPoints }}"
                stroke-color = "#990000"
                stroke-opacity = "1.0"
                stroke-weight = "2">
            </shape>
        </ng-map>
        <div id="route-data">
            <div id="route-data-details">
                <div id="route-data-hr">
                    HR <span id="bpm">{{ cursor.bpm }}</span>
                </div>
                <div id="route-data-altitude">
                    Alt <span id="altitude">{{ cursor.altitude }}</span>
                </div>
                <table>
                <tr><td>Title</td><td><input type="text" name="saved-title" ng-model="route.title"></td></tr>
                <tr><td>Start time</td><td>{{ route.data.startTime }}</td></tr>
                <tr><td>End time</td><td>{{ route.data.trackPoints[route.data.trackPoints.length-1].timeStamp }}</td></tr>
                <tr><td>Length</td><td>{{ route.data.trackPoints[route.data.trackPoints.length-1].distance }} meters</td></tr>
                <tr><td>Device</td><td>{{ route.data.device }}</td></tr>
                <tr><td>Weather</td><td><input type="text" name="saved-weather" ng-model="route.weather"></td></tr>
                <tr><td>Comment</td><td><textarea name="saved-comment" cols="40" rows="3" ng-model="route.comment"></textarea></td></tr>
                <tr><td>Updated</td><td>{{ route.updated }}</td></tr>
                <tr><td></td><td><button ng-click="updateRoute(route._id)">Save changes</button></td></tr>
                </table>
            </div>
        </div>
    </div>
    
    <div id="status-bar">
        {{ status.text }}
    </div>
    
  </body>